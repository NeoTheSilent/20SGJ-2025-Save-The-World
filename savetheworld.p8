pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	timer=0
	frame=30
	clr=6
	explosion=0
	stumble=false
	stumbletimer=0
	
	qtetimer=0
	active=0
	
	ts=true
	flicker=true
	flickertimer=15
	hard=false
	hardinc=2
	endanim=0
	mus={0,0,0}
	
	player={}
		player.x=60
		player.y=98
		player.d=0
		player.m=2

	distance={300,600,900,1200,1600}

	answer={}
	for i=1,4 do
	 answer[i]={}
	 for j=1,i+1 do
 	 answer[i][j]=flr(rnd(4))+2
 	end
 end
	
	rndxy={}
	for i=1,20 do
	 rndxy[i]={rnd(100),rnd(100),rnd(8)}
	end
	
	answerkey={"","â¬†ï¸","â¬‡ï¸","ğŸ…¾ï¸","â"}
	
end

function _update()
 
 if endanim<=100 then
  tup()
 else
  gup()
 end
 
 if ts and mus[1]==0 then
	 sfx(10)
	 mus[1]=1
	elseif endanim>100 and mus[2]==0 then
  sfx(10,-2)
  sfx(09,-1,timer*4)
	 mus[2]=1
	elseif player.x==172 and mus[3]==0 then
	 sfx(09,-2)
	 sfx(08)
	 mus[3]=1
	end
	
	if explosion>0 then
	 sfx(09,-2)
	end
	
end

function _draw()
 cls()
 if endanim<=100 then
  title()
 else
	 map(0,0)
	 debug()
	 gamevis()
 end
end

-->8
--movement

function move()
 if player.x!=172 and explosion==0 then
	 if btn(1) and not stumble then
	  if player.x==120 
	  and player.d<distance[5] then
	   player.d+=4
	  elseif active==0 then
		  player.x+=player.m
		 end
	 elseif btn(0) and not stumble then
	  if player.d>0  then
	   player.d-=4
	  elseif player.x>16 then
	   player.x-=player.m
	  end
	 end
	end
end
-->8
--qte

function qte(num,rep)
--
 if distance[num]==player.d then
  qtetimer=0
 elseif distance[num]<player.d and rep[#rep]!=0 then
  for i=1,#rep do
   if active<i then
	   sspr(0+((flr(qtetimer/4)*8)*(tonum(active+1==i))),
	   24,8,8,(player.x-4)+(i*16)
	   -(ceil(#rep/2)*16)-(8-(#rep%2)*8),
	   player.y-30,16,16)
	   print(answerkey[rep[i]],(player.x+1)+(i*16)
	   -(ceil(#rep/2)*16)-(8-(#rep%2)*8),
	   player.y-25)
	  end
	 end
--if
	 if btnp(rep[active+1]) then
	  if active!=#rep then
    set(rep)
    sfx(01+active-1)
	  end
	 else
		 for i=2,5 do
	   if (btnp(i) and i!=rep[active+1])
	   or qtetimer>=60 then
					trip(rep)
					rest(rep,num)
					sfx(00)
	   end
	  end
	 end
  
  if active==#rep then
   rest(rep,num)
  end
	end
end

function set()
 active+=1
	qtetimer=0
end

function rest(rep,num)
 distance[num+1]+=player.d%100
 active=0
 rep[#rep]=0
end

function trip(rep)
 stumble=true
	stumbletimer+=30*(#rep-active)
	qtetimer=0
end
-->8
--debug

function debug()
 --print("normal timer: "..timer,player.x-60,player.y-60,3)
 print("distance: "..distance[1].." "..distance[2].." "..distance[3].." "..distance[4],player.x-30,player.y+46,3)
 print("player.d: "..player.d,player.x-30,player.y+36,3)
 print(btn(),player.x-30,player.y+56)
end
-->8
-- ui

function ui()
 msg1="this could've been avoided..."
 msg2="if you tied your shoes."
 msg3="press â to restart"
 msg4="sponsored by big shoelace"
--gameover
 if explosion>59 then
  camera(440,440)
  for i=1,20 do
   sspr(0,8,16,16,440+rndxy[i][1],440+rndxy[i][2],4,4)
  end
--earth
  circfill(500,500,25,1)
  circfill(500,500,24,12)
  sspr(0,32,8,8,480,490,15,18)
  sspr(8,32,8,8,490,480,20,25)
  sspr(0,40,8,8,475,510,37,8)
  sspr(8,40,8,8,516,487,5,20)
  circfill(490,495,abs(flr(explosion/45)),8)
--sun
  circfill(450,490,8,9)
  circfill(450,490,7,10)
  
  if player.x==172 then
	  ending(msg1,502-(#msg1*2),450,150)
	  ending(msg2,502-(#msg2*2),460,200)
	  ending(msg4,502-(#msg4*2),550,269)
	 end
	 
	 ending(msg3,502-(#msg3*2),540,239)


--normal gameplay
	elseif player.x>60 then	
  camera(player.x-60,player.y-60)
  print(19-timer.."."..frame*3,player.x-7,player.y-30,clr) 
	elseif player.x==172 then
	 camera(172,player.y-60)
	 print(19-timer.."."..frame*3,165,player.y-30,clr) 
	else
	 camera(0,player.y-60)
	 print(19-timer.."."..frame*3,53,player.y-30,clr) 
	end
end

function ending(text,x,y,delay)
 if explosion>delay then
 	print(text,x-1,y,0)
 	print(text,x+1,y)
 	print(text,x,y-1)
 	print(text,x,y+1)
 	print(text,x,y,8)
	end
end
-->8
-- variable updates and visuals

--title update
function tup()
 flickertimer-=1
 if flickertimer==0 then
  flickertimer=15
  flicker=not flicker
 end
 
 if endanim==0 then
  if btnp(4) then
   ts=not ts
   if hard then
	   for i=1,4 do
	    for j=1,hardinc do
	     answer[i][#answer[i]+1]=flr(rnd(4))+2
	    end
	   end
	  end
  elseif (btnp(2) or btnp(3)) then
   hard=not hard
  end
 end
 
 if not ts then
  endanim+=1
 end
end

--title visual
function title()
 print("\^w\^t   you can\nsave the world",10,44,12)
 spr(034+(flicker and 1 or 0),25,100+(hard and 8 or 0))
 print("normal mode",36,102)
 print("hard mode",36,110)
 
 for i=1,7 do
	 rectfill(270+(200*(i-1)),54,300+(200*(i-1)),111,5)
	end
	for i=1,200 do
	 sspr(32,0,16,16,(-100+i*16),74)
	 sspr(64,0,32,16,(-100+i*32),24)
	end

 for i=1,16 do
  for j=1,16 do
--first set of checkerboard
   if endanim>(j*2)
   and ((i%2==0 and j%2==1) 
   or (i%2==1 and j%2==0)) then
    rectfill(
    -8+(i*8),0+(j*8),
    -1+(i*8),7+(j*8),6)
   end
--second set of checkerboard
   if endanim-(j*3)>=30
   and ((i%2==1 and j%2==1) 
   or (i%2==0 and j%2==0)) then
    rectfill(
    -8+(i*8),0+(j*8),
    -1+(i*8),7+(j*8),6)
   end
  end
 end
end

--game update
function gup()
 --[[timer update]]--
 if timer!=20 and frame!=0 then
	 frame-=1
 end
 if frame==0 then
  if timer!=19 then
   frame=30
   timer+=1
	 elseif timer==19 and explosion!=270 then
	  explosion+=1
  end
 end
 --[[qte timer update]]--
 qtetimer+=1
 --[[stumble]]
 if stumbletimer!=0 then
  stumbletimer-=1
 else
  stumble=false
 end
--[[color for timer]]--
	if timer>=10 and timer<15then
	 clr=9
	elseif timer>=15 then
	 if frame<15 then
	  clr=9
	 else
	  clr=8
	 end
	end
	move()
end

--game visual
function gamevis()
 for i=1,4 do
  if player.d>=distance[i] then
	  if i!=1 and
	  answer[i-1][#answer[i-1]]!=0 then
    for j=i,#distance do
     distance[j]+=100
    end
   end
   
   if answer[i][#answer[i]]!=0 then
	   qte(i,answer[i])
	  end
	 end
 end
	ui() 
 for i=1,7 do
	 rectfill(270-player.d+(200*(i-1)),54,300-player.d+(200*(i-1)),111,5)
	end
	for i=1,200 do
	 sspr(32,0,16,16,(-100+i*16-(player.d/2)),player.y+14)
	 sspr(64,0,32,16,(-100+i*32-(player.d/2)),player.y-50)
	end
	sspr(104,0,16,16,0,2,16,100)	
	rectfill(0,0,1000,47,5)
	spr(001,player.x,player.y)
--end world
	circfill(216,104,explosion*1.5,6)
	circfill(216,104,explosion,7)
end
__gfx__
00000000444444445666666666666665799aaaa7aa9966a700000000000000005555555555555555555555555555555556666666666666666666666500000000
00000000400000046dddddddddddddd1679999777997666607777777777777705555555555555555555555555555555556666666666666666666666500000000
00700700404004046d166666666661d16666777777777666075555555555557055dddd555dddd75555dddd555dddd75556666666666666666666666500000000
00077000404004046d6dddddddddd5d1666666667777666606577775577775707ddddd7ddddd77777ddddd7ddddd777756666666666666666666666500000000
00077000400000046d6dddddddddd5d15566666666666655065667755777757067ddd767ddd7766667ddd767ddd7766656666666666666666666666500000000
00700700404444046d6dd222222dd5d1d55555555555555d06566665577775706666666666666666666666666666666656666666666666666666666500000000
00000000400000046d6dd2e8782dd5d1dddddddddddddddd06566665567775700060000000000600000000000000000056666666666666666666666500000000
00000000444444446d6dd2e8782dd5d1dddddddddddddddd06566665566775700060000000000600000000000000000056666666666666666666666500000000
00000007000000006d6dd288782dd5d1dddddddddddddddd06566665566665b00060000000000600000000000000000056666666666666666666666500000000
00000007000000006d6dd288872dd5d1dddddddddddddddd06566665566665800666666666666660000000000000000056666666666666666666666500000000
00000077700000006d6dd222222dd5d10ddd0ddd0dd0dddd06566665566665706699999aaaaaaa66000000000000000056666666666666666666666500000000
00000077700000006d6dddddddddd5d1dd0ddd0dd0ddd0dd0d5666655666657006aaaaaaa9999960000000000000000056666666666666666666666500000000
00000776770000006d6dddddddddd5d1000dd00d000dd0d00d566665566665700000000000000000000000000000000056666666666666666666666500000000
00007766677000006d155555555551d100dddd000d00dd0d0d5dd665566665700000000000000000000000000000000056666666666666666666666500000000
00777666667770006dddddddddddddd10000000000d0d00d0d5dddd55dd665700000000000000000000000000000000056666666666666666666666500000000
7776666666667770511111111111111500000000000000000d5dddd55dddd5700000000000000000000000000000000056666666666666666666666500000000
00777666667770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000776667700000d6600000d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000077677000000d7766000d7766000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000007770000000dd777660d8ee7660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000007770000000ddddd776d888ee76000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000700000000dd555110d8225110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000700000000d5511000d5511000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000d1100000d1100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222022222220222222202222222022222220222222202222222022222220222222202222222022222220222222002222000022000000000000000000000
20000002000000020000000200000002000000020000000200000002000000020000000200000002000000020000000000000000000000000000000000000000
20000002200000020000000200000002000000020000000200000002000000020000000200000002000000000000000000000000000000000000000000000000
20000002200000020000000200000002000000020000000200000002000000020000000200000002000000000000000000000000000000000000000000000000
20000002200000022000000200000002000000020000000200000002000000020000000200000000000000000000000000000000000000000000000000000000
20000002200000022000000200000002000000020000000200000002000000020000000200000000000000000000000000000000000000000000000000000000
20000002200000022000000220000002000000020000000200000002000000020000000000000000000000000000000000000000000000000000000000000000
22222222222222222222222222222222022222220002222200000222000000020000000000000000000000000000000000000000000000000000000000000000
00003000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003303333300030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033333333330330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033333033333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033330033333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033033333033330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00330333000033330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333330003333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333330033330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033333033330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033003333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0e00000000000000000000000000000000000000000000000000000c0d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d1e00000000000000000000000000000000000000000000000000000c0d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0e00000000000000000000000000000000000000000000000000000c0d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d1e00000000000000000000000000000000000000000000000000001c1d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0e00000000000000000000000000000000000000000000000000000c0d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d1e00000000000000000000000000000000000000000000000000001c1d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d0e00000607000000000000000000000000000000000000000002030c0d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d1e00001617000000000000000000000000000000000000000012131c1d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00100000072502a5002b5002b7002b7002b7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000002655000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000002a55000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000002f55000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000003455000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000003855000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000003c55000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000003f55000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000c45008450044500960000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc2000201851014510125100e5101251017510145101051014510195101c510185101351016510195101d510235101d51014510175101b5102051029510305102a51024510205101c51027510245101e51017510
94400020077100a7100d710087100c7100f710097100c71010710127100a7100e7101271016710197100a7100f710137101471011710177101971018710157101171017710127100f7101771014710107100d710
__music__
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546
00 43444546

